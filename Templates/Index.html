<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Chatbot</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <button class="new-chat-btn">+ New Chat</button>
      <div class="chat-history">
        <div class="chat-item active">✨ Getting Started</div>
      </div>
      <div class="sidebar-footer">
        <div class="user-profile">
          <div class="avatar">U</div>
          <span>User Profile</span>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="chat-header">
        <div class="model-selector">ChatGPT 4.0 ▼</div>
      </div>
      <div class="chat-messages">
        <div class="welcome-screen">
          <h1 class="welcome-title">How can I help you today?</h1>
          <p class="welcome-subtitle">Ask me anything, and I'll do my best to assist you</p>
        </div>
      </div>
      <div class="input-container">
        <div class="input-wrapper">
            <label>
                <textarea class="message-input" placeholder="Send a message..." rows="1"></textarea>
            </label>
            <button class="send-button">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const messageInput = document.querySelector('.message-input');
    const sendButton = document.querySelector('.send-button');
    const chatMessages = document.querySelector('.chat-messages');
    const welcomeScreen = document.querySelector('.welcome-screen');

    messageInput.addEventListener('input', function () {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 120) + 'px';
      sendButton.disabled = !this.value.trim();
    });

    messageInput.addEventListener('keydown', function (e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    sendButton.addEventListener('click', sendMessage);

    // Add this to your existing script section to handle the selectors
const examBoardSelector = document.querySelector('.exam-board-selector');
const subjectSelector = document.querySelector('.subject-selector');

// Update the sendMessage function to use the selected values
function sendMessage() {
  const message = messageInput.value.trim();
  if (!message) return;

  if (welcomeScreen) {
    welcomeScreen.style.display = 'none';
  }

  addMessage(message, 'user');

  messageInput.value = '';
  messageInput.style.height = 'auto';
  sendButton.disabled = true;

  fetch("http://localhost:8000/ask", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      subject: subjectSelector.value,
      exam_board: examBoardSelector.value,
      question: message
    })
  })
    .then(res => res.json())
    .then(data => {
      if (data.answer) {
        addMessage(data.answer, 'bot');
      } else {
        addMessage("⚠️ Error: " + (data.error || "No response."), 'bot');
      }
    })
    .catch(err => {
      addMessage("⚠️ Network error: " + err.message, 'bot');
    });
}

    function addMessage(text, sender) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender}-message`;
      messageDiv.innerHTML = `
        <div class="message-avatar">${sender === 'user' ? 'U' : 'AI'}</div>
        <div class="message-content">
          <div class="message-text">${text}</div>
        </div>
      `;
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
  </script>
</body>
</html>